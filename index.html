<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Creation</title>
    <style>
        .character {
            display: inline-block;
            width: 200px;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        .character img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        #startButton {
            display: block;
            margin-top: 20px;
        }

        #characterList {
            margin-top: 20px;
            text-align: center;
        }

        .characterBox {
            display: inline-block;
            width: 200px;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        .characterBox img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <div id="characterCreation">
        <button id="addCharacter" style="margin: 10px;">+</button>
        <button id="exportCharacters" style="margin: 10px;">></button>
        <button id="uploadCharacters" style="margin: 10px;">^</button>
        <!--<input type="text" id="uploadCharactersString">-->
    </div>

    <button id="startButton">Start</button>

    <div id="characterList"></div>

    <script>

        //Glimmerỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/506208.jpgỎMarvelỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/2555391.jpgỎCloveỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/1334447344.jpgỎCatoỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/3210631.jpgỎKaliaỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/1334446516.jpgỎIanỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/671552.jpg?1334446965ỎTaraỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/9149892.jpgỎEthanỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/7454798.jpgỎFoxfaceỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/2352935.jpgỎChrisỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/9596832.jpgỎKaraỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/7488391.jpgỎAshtonỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/6708769.jpgỎLeighaỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/5550500.jpgỎSamỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/433180.jpgỎMackenzieỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/2352935.jpgỎSamuelỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/4487615.jpgỎAnnieỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/3532547.jpgỎImanolỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/3876590.jpgỎDakotaỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/7846373.jpgỎJeremyỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/7456491.jpgỎRueỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/7353160.jpgỎThreshỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/5362758.jpgỎKatnissỏ3ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/219371.jpgỎPeetaỏ2ỏhttps://thehungergamesdistrict12katniss.weebly.com/uploads/1/1/7/4/11747811/1334534354.jpg

        var charactersArray = [];

        var gameState;
        var inGame = false;

        document.getElementById("uploadCharacters").addEventListener("click", function () {

            //var characterStringArray = document.getElementById("uploadCharactersString").value.split("~");
            //var characterStringArray = navigator.clipboard.readText().toString().split("~");
            //navigator.clipboard.readText()
                //.then(text => {
                    //characterStringArray = text.toString().split("Ỏ");
                    characterStringArray = "Glimmerỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Glimmer.jpgỎMarvelỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Marvel.jpgỎCloveỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Clove.jpgỎCatoỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Cato.jpgỎKaliaỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Kalia.jpgỎIanỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Ian.jpgỎTaraỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Tara.jpgỎEthanỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Ethan.jpgỎFoxfaceỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Foxface2.jpgỎChrisỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Chris.jpgỎKaraỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Kara.jpgỎAshtonỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Ashton.jpgỎLeighaỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Leigha.jpgỎSamỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Sam.jpgỎMackenzieỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Mackenzie.jpgỎSamuelỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Samuel.jpgỎAnnieỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Annie.jpgỎImanolỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Imanol.jpgỎDakotaỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Dakota.jpgỎJeremyỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Jeremy.jpgỎRueỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Rue.jpgỎThreshỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Thresh.jpgỎKatnissỏ3ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Katniss.jpgỎPeetaỏ2ỏhttps://raw.githubusercontent.com/BlueGameMC/BetterHungerGames/main/Images/Peeta.jpg".split("Ỏ");
                    for (let i = 0; i < characterStringArray.length; i++) {
                        var characterString = characterStringArray[i];
                        var characterCurrent = characterString.split("ỏ")

                        var characters = document.getElementById("characterCreation");
                        var newCharacter = document.createElement("div");
                        newCharacter.classList.add("character");
                        newCharacter.style.margin = "10px";
                        var characterCount = characters.querySelectorAll(".character").length + 1;
                        newCharacter.innerHTML = `
        <label for="name${characterCount}">Name:</label>
        <input type="text" id="name${characterCount}" name="name${characterCount}" value="${characterCurrent[0]}">
        <label for="pronouns${characterCount}">Pronouns:</label>
        <select id="pronouns${characterCount}" name="pronouns${characterCount}">
            <option value="1">They/Them</option>
            <option value="2">He/Him</option>
            <option value="3">She/Her</option>
            <option value="4">It/It's</option>
        </select>
        <label for="image${characterCount}">Image URL:</label>
        <input type="text" id="image${characterCount}" name="image${characterCount}" value="${characterCurrent[2]}" style="font-size:10px">
        <img id="preview${characterCount}" src="${characterCurrent[2]}" alt="Preview" style="height: 100px;">
      `;
                        characters.insertBefore(newCharacter, document.getElementById("addCharacter"));
                        document.getElementById("pronouns" + characterCount).value = characterCurrent[1];
                    }
                })
                //.catch(err => {
                //    alert('Failed to read clipboard contents: ', err);
                //});

        //});

        document.getElementById("exportCharacters").addEventListener("click", function () {
            var characters = document.querySelectorAll(".character");
            var outputString = "";
            characters.forEach(function (character, index) {
                var name = character.querySelector("input[type=text]").value;
                var pronouns = character.querySelector("select").value;
                var imageSrc = character.querySelector("img").src;
                if (index > 0) outputString = outputString + "Ỏ"
                outputString = outputString + name + "ỏ" + pronouns + "ỏ" + imageSrc;
            });
            navigator.clipboard.writeText(outputString);
            alert("Copied to Clipboard");
        });

        document.getElementById("addCharacter").addEventListener("click", function () {
            var characters = document.getElementById("characterCreation");
            var newCharacter = document.createElement("div");
            newCharacter.classList.add("character");
            newCharacter.style.margin = "10px";
            newCharacter.style.top = "0px";
            var characterCount = characters.querySelectorAll(".character").length + 1;
            newCharacter.innerHTML = `
      <label for="name${characterCount}">Name:</label>
      <input type="text" id="name${characterCount}" name="name${characterCount}">
      <label for="pronouns${characterCount}">Pronouns:</label>
      <select id="pronouns${characterCount}" name="pronouns${characterCount}">
          <option value="1">They/Them</option>
          <option value="2">He/Him</option>
          <option value="3">She/Her</option>
          <option value="4">It/It's</option>
      </select>
      <label for="image${characterCount}">Image URL:</label>
      <input type="text" id="image${characterCount}" name="image${characterCount}" style="font-size:10px">
      <img id="preview${characterCount}" src="#" alt="Preview" style="height: 100px;">
    `;
            characters.insertBefore(newCharacter, document.getElementById("addCharacter"));
        });

        document.addEventListener("change", function (event) {
            if (event.target && event.target.matches("input[type=text]")) {
                var input = event.target;
                var imageInput = input.parentNode.querySelector("img");
                imageInput.src = input.value;
                imageInput.style.display = "block";
            }
        });

        document.getElementById("startButton").addEventListener("click", function () {
            var characterBoxes = document.getElementById("characterList");
            characterBoxes.innerHTML = ""; // Clear previous entries

            charactersArray = []; // Clear previous array

            document.getElementById("startButton").remove();
            document.getElementById("addCharacter").remove();
            document.getElementById("exportCharacters").remove();
            document.getElementById("uploadCharacters").remove();
            var characters = document.querySelectorAll(".character");
            characters.forEach(function (character, index) {
                var name = character.querySelector("input[type=text]").value;
                var pronouns = character.querySelector("select").value;
                var imageSrc = character.querySelector("img").src;
                character.remove();

                if (pronouns == 1) {
                    pronouns = ["they", "them", "theirs", "themself"];
                }
                else if (pronouns == 2) {
                    pronouns = ["he", "him", "his", "himself"];
                }
                else if (pronouns == 3) {
                    pronouns = ["she", "her", "her", "herself"];
                }
                else if (pronouns == 4) {
                    pronouns = ["it", "it", "it's", "itself"];
                }

                var characterTraits = ["Weak", "Strong", "Clumsy", "None","None","None"];

                // Add character object to array
                charactersArray.push({
                    name: name,
                    pronouns: pronouns,
                    imageSrc: imageSrc,
                    hurt: false,
                    trait: characterTraits[Math.floor(Math.random() * characterTraits.length)],
                    dead: false,
                    items: ["Food","Water"]
                });

            });

            /*for (let i = 0; i < charactersArray.length; i++) {
                const character = charactersArray[i];
                // Display character in box below start button
                var characterBox = document.createElement("div");
                characterBox.classList.add("characterBox");
                characterBox.innerHTML = `
            <p>${character.name}</p>
            <p>${character.pronouns}</p>
            <img src="${character.imageSrc}" alt="${character.name}" style="height: 100px;">
          `;
                characterBoxes.appendChild(characterBox);
            }
            */

            inGame = true;
            gameState = "start"
            livingCharacters = charactersArray;
            turn();
        });

        var livingCharacters;
        //var actionCountList = [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 4];
        var actionCountList = [1, 1, 1, 1, 2, 2, 2, 2, 2, 3];

        function turn() {

            window.scrollTo(0, 0);



            if(document.getElementById("nextTurn") != undefined) {document.getElementById("nextTurn").remove()};
            
            livingCharacters.sort(() => Math.random() - 0.5);
            var currentCharacters = Array.from(livingCharacters);
            
            console.log(livingCharacters.length);
            
            var characterBoxes = document.getElementById("characterList");
            characterBoxes.innerHTML = ""; // Clear previous entries


            if (gameState == "start") {
                gameState = "bloodbath";
                var actionTextElement = document.createElement("b");
                actionTextElement.innerHTML = "<br> <br> <br> Bloodbath <br>";
                characterBoxes.appendChild(actionTextElement);
            }
            else if(gameState == "bloodbath")
            {
                gameState = "bloodbath2";
                var actionTextElement = document.createElement("b");
                actionTextElement.innerHTML = "<br> <br> <br> Bloodbath (cont.) <br>";
                characterBoxes.appendChild(actionTextElement);
            }
            else if(gameState == "bloodbath2")
            {
                gameState = "bloodbath2";
                var actionTextElement = document.createElement("b");
                actionTextElement.innerHTML = "<br> <br> <br> Bloodbath (cont.) <br>";
                characterBoxes.appendChild(actionTextElement);
            }

            var length = Math.floor(Math.random() * 4) + Math.floor(currentCharacters.length / (Math.floor(Math.random() * 5) + 1));
            
            if (livingCharacters.length == 1) {
                characterBoxes.innerHTML = ""; // Clear previous entries
   
                var actionTextElement = document.createElement("a");
                actionTextElement.innerHTML = "<br> <br> <br> WINNER!!! <br>";
                characterBoxes.appendChild(actionTextElement);
                        
                var character = livingCharacters[0];
                // Display character in box below start button
                var characterBox = document.createElement("div");
                characterBox.classList.add("characterBox");
                characterBox.innerHTML = `
                <p>${character.name}</p>`
                characterBox.innerHTML += `
                <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px;">
                `;
                characterBoxes.appendChild(characterBox);
                return;
            }

            if (gameState == "bloodbath" || gameState == "bloodbath2"){
                length = Math.floor(currentCharacters.length / 3) + (Math.floor(Math.random() * 4) - 2);
            }

            if (length > currentCharacters.length)
            {
                length = currentCharacters.length;
            }

            if(length <= 2)
            {
                length = currentCharacters.length;
            }

            if (currentCharacters.length <= 3) {
                length = currentCharacters.length;
            }
            
            function addActions(character, actionArray, people)
            {
                if (people == 1) {
                    
                    if(gameState=="bloodbath" || gameState == "bloodbath2")
                    {
                        actionArray.push(["@1n# falls down a hill and gets hurt.#@1h"]);
                        actionArray.push(["@1n# accidentally cuts #@13# and gets hurt.#@1h"]);
                        actionArray.push(["@1n# falls down a hill and dies.#@1k"]);
                    }

                    if (character.hurt) {
                        for (let j = 0; j < 5; j++) {
                            actionArray.push(["@1n# dies from #@12# injuries.#@1k"]);
                        }
                        actionArray.push(["@1n# heals from #@12# injuries.#@1r"]);
                        actionArray.push(["@1n# heals from #@12# injuries.#@1r"]);
                        if (character.items.includes("Health")) {
                            for (let j = 0; j < 10; j++) {
                            actionArray.push(["@1n# heals with #@12# first aid kit.#@1r"]);
                        }
                        }
                    }
                    if (character.trait == "Clumsy") {
                        for (let j = 0; j < 1; j++) {
                            actionArray.push(["@1n# falls down a hill and dies.#@1k"]);
                            actionArray.push(["@1n# falls down a hill and gets hurt.#@1h"]);
                            actionArray.push(["@1n# grabs a backpack, not realizing it is empty."]);
                            if (gameState=="bloodbath") {
                                actionArray.push(["@1n# trips off the podium and blows up.#@1k"]);
                            }
                            actionArray.push(["@1n# accidentally cuts #@13# and gets hurt.#@1h"]);
                            if (character.items.includes("Explosive")) {
                                actionArray.push(["@1n# sets up some explosives but accidentally triggers them too soon, killing #@11#.#@1k"]); 
                            }
                        }
                    }
                    if (character.trait == "Weak") {
                        for (let j = 0; j < 1; j++) {
                            actionArray.push(["@1n# accidentally cuts #@13# and gets hurt.#@1h"]);
                            actionArray.push(["@1n# falls down a hill and gets hurt.#@1h"]);
                            actionArray.push(["@1n# falls down a hill and dies.#@1k"]);
                            actionArray.push(["@1n# runs into the cornucopia and hides."]);
                            actionArray.push(["@1n# runs into the forest."]);
                            actionArray.push(["@1n# attempts suicide, but it fails, leaving #@11# hurt.#@1h"]);
                            actionArray.push(["@1n# commits suicide.#@1k"]);
                        }
                    }
                    if (character.trait == "Strong") {
                        for (let j = 0; j < 1; j++) {
                            actionArray.push(["@1n# finds a bow, some arrows, and a quiver.#@1wb"]);
                            actionArray.push(["@1n# finds a canteen full of water.#@1iw"]);
                            actionArray.push(["@1n# gathers as much food as #@10# can.#@1if"]);
                            actionArray.push(["@1n# grabs a sword.#@1ws"]);
                            actionArray.push(["@1n# finds a bag full of explosives.#@1we"]);
                            actionArray.push(["@1n# grabs a backpack of supplies.#@1ig"]);
                        }
                    }
                    if(!character.items.includes("Water"))
                    {
                        if(Math.random() > 0.5)
                        {
                            actionArray.push(["@1n# dies of thirst.#@1k"]);

                        } 
                    }
                    else if (Math.random() > 0.5)
                    {
                        actionArray.push(["@1n# drinks all #@12# water.#@1iw0"]);
                        actionArray.push(["@1n# spills all #@12# water.#@1iw0"]);
                        if (character.trait == "Clumsy") 
                        {
                            actionArray.push(["@1n# spills all #@12# water.#@1iw0"]);
                        }
                    }
                    if(!character.items.includes("Food"))
                    {
                        if(Math.random() > 0.6)
                        {
                            actionArray.push(["@1n# starves.#@1k"]);
                        }
                    }
                    else if (Math.random() > 0.5)
                    {
                        actionArray.push(["@1n# eats all #@12# food.#@1if0"]);
                        actionArray.push(["@1n# loses all #@12# food.#@1if0"]);
                        if (character.trait == "Clumsy") 
                        {
                            actionArray.push(["@1n# loses all #@12# food.#@1if0"]);
                        }
                    }

                }
                else if (people == 2)
                {

                    if(gameState=="bloodbath" || gameState == "bloodbath2")
                    {
                        actionArray.push(["@1n# and #@2n# fight and are both injured.#@1h#@2h"]);
                        actionArray.push(["@1n# strangles #@2n#.#@2k"]);
                        actionArray.push(["@2n# strangles #@1n#.#@1k"]);
                        actionArray.push(["@1n# and #@2n# fight and #@2n# is hurt.#@2h"]);
                        actionArray.push(["@2n# and #@1n# fight and #@1n# is hurt.#@1h"]);
                        actionArray.push(["@1n# and #@2n# fight and #@2n# is killed.#@2k"]);
                        actionArray.push(["@2n# and #@1n# fight and #@1n# is killed.#@1k"]);
                        actionArray.push(["@1n# snaps #@2n#'s neck.#@2k"]);
                        actionArray.push(["@2n# snaps #@1n#'s neck.#@1k"]);
                        actionArray.push(["@1n# and #@2n# find water together.#@1iw#@2iw"]);
                        actionArray.push(["@1n# and #@2n# look for water together, but find nothing."]);
                    }

                    if(character.trait=="Strong")
                    {
                        actionArray.push(["@1n# snaps #@2n#'s neck.#@2k"]);
                        actionArray.push(["@1n# strangles #@2n#.#@2k"]);
                        actionArray.push(["@1n# attacks #@2n# and injures #@21#.#@2h"]);
                    }
                    if(character.trait=="Weak")
                    {
                        actionArray.push(["@2# snaps #@1n#'s neck.#@1k"]);
                        actionArray.push(["@2n# strangles #@1n#.#@1k"]);
                        actionArray.push(["@2n# attacks #@1n# and injures #@11#.#@1h"]);
                    }
                    if (character.items.includes("Sword")) {
                        if (character.trait == "Strong") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# stabs #@2n# with #@12# sword and kills #@21#.#@2k"]);
                                actionArray.push(["@1n# cuts #@2n# with #@12# sword and injures #@21#.#@2h"]);
                            }
                        }
                        if (character.trait == "Weak") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# tries and fails to stab #@2n# with #@12# sword #@21#."]);
                                actionArray.push(["@1n# cuts #@2n# with #@12# sword and injures #@21#.#@2h"]);
                                actionArray.push(["@2n# stabs #@1n# with #@22# sword and kills #@11#.#@1k"]);
                            }
                        }
                        if (character.trait == "Clumsy") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# tries to stab #@2n# with #@12# sword but cuts #@12# instead.#@1h"]);
                                actionArray.push(["@1n# cuts #@2n# with #@12# sword and injures #@21#.#@2h"]);
                            }
                        }
                        for (let j = 0; j < 2; j++) {
                            actionArray.push(["@1n# stabs #@2n# with #@12# sword and kills #@21#.#@2k"]);
                            actionArray.push(["@1n# stabs #@2n# with #@12# sword and kills #@21#.#@2k"]);
                            actionArray.push(["@1n# cuts #@2n# with #@12# sword and injures #@21#.#@2h"]);
                            actionArray.push(["@1n# cuts #@2n# with #@12# sword and injures #@21#.#@2h"]);
                        }
                    }
                    if (character.items.includes("Bow")) {
                        if (character.trait == "Strong") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# shoots #@2n# and kills #@21#.#@2k"]);
                                actionArray.push(["@1n# hits #@2n# with #@12# bow and injures #@21#.#@2h"]);
                            }
                        }
                        if (character.trait == "Weak") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# hits #@2n# with #@12# bow and injures #@21#.#@2h"]);
                                actionArray.push(["@2n# shoots #@1n# and kills #@11#.#@1k"]);
                            }
                        }
                        if (character.trait == "Clumsy") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# tries to shoot #@2n# with #@12# but misses."]);
                                actionArray.push(["@1n# hits #@2n# with #@12# bow and injures #@21#.#@2h"]);
                            }
                        }
                        for (let j = 0; j < 2; j++) {
                            actionArray.push(["@1n# shoots #@2n# and kills #@21#.#@2k"]);
                            actionArray.push(["@1n# shoots #@2n# and kills #@21#.#@2k"]);
                            actionArray.push(["@1n# shoots #@2n# and kills #@21#.#@2k"]);
                            actionArray.push(["@1n# hits #@2n# with #@12# bow and injures #@21#.#@2h"]);
                        }
                    }
                    if (character.items.includes("Explosive")) {
                        if (character.trait == "Clumsy") {
                            for (let j = 0; j < 1; j++) {
                                actionArray.push(["@1n# sets up some explosives but couldn't get away quick enough, killing #@11# and #@2n#.#@2k#@1k"]);
                            }
                        }
                        for (let j = 0; j < 4; j++) {
                            actionArray.push(["@1n# sets up some explosives and kills #@2n#.#@2k"]);
                        }
                        actionArray.push(["@1n# sets up some explosives but couldn't get away quick enough, killing #@11# and #@2n#.#@2k"]);
                    }
                }
                return actionArray;
            }

            for (let i = 0; i < length; i++) {

                if (currentCharacters.length > 1) {
                
                    
                        var actionCount = actionCountList[Math.floor(Math.random() * actionCountList.length)];
                        if (actionCount > currentCharacters.length) {actionCount=currentCharacters.length}
                        //var actionCount = 1;
                        var action;
                        if (actionCount == 1) 
                        {
                            /*let actionArray = 
                            [
                                ["@1n# decides to kill #@13# and dies #@1k"],
                                ["@1n# decides to kill #@13# and fails, injuring #@13#@1h"],
                                ["@1n# falls down a hill and gets hurt#@1h"],
                                ["@1n# falls down a hill and gets hurt#@1h"],
                                ["@1n# falls down a hill and gets hurt#@1h"],
                                ["@1n# falls down a hill and dies#@1k"],
                                ["@1n# finds a backpack full of gear#@1ig"],
                                ["@1n# finds a spear#@1ws"],
                            ]*/

                            let actionArray =
                            [
                                    ["@1n# steps off the podium too soon and blows up.#@1k"],
                                    ["@1n# finds a bow, some arrows, and a quiver.#@1wb"],
                                    ["@1n# runs into the cornucopia and hides."],
                                    ["@1n# runs into the forest"],
                                    ["@1n# finds a canteen full of water.#@1iw"],
                                    ["@1n# gathers as much food as #@10# can.#@1if"],
                                    ["@1n# grabs a sword.#@1ws"],
                                    ["@1n# finds a bag full of explosives.#@1we"],
                                    ["@1n# clutches a first aid kit and runs away.#@1ih"],
                                    ["@1n# grabs a backpack, not realizing it is empty."],
                                    ["@1n# grabs a backpack of supplies.#@1ig"],
                            ];
                            if(gameState == "bloodbath2")
                            {
                                actionArray.shift();
                            }

                            actionArray = addActions(currentCharacters[0], actionArray, 1);

                            //console.log(actionArray);
                            let a = Math.floor(Math.random() * actionArray.length);
                            action = actionArray[a];
                        }
                        if (actionCount == 2) {

                            let actionArray =
                            [
                                ["@1n# and #@2n# fight for a backpack and #@1n# strangles #@21# with the straps.#@2k#@1ig"],
                                ["@2n# and #@1n# fight for a backpack and #@2n# strangles #@11# with the straps.#@1k#@2ig"],
                                ["@1n# steals a bow from #@2n#.#@1wb"],
                                ["@2n# steals a bow from #@1n#.#@2wb"],
                                ["@1n# steals a sword from #@2n#.#@1ws"],
                                ["@2n# steals a sword from #@1n#.#@2ws"],
                            ];
                            
                            actionArray = addActions(currentCharacters[0], actionArray, 2);

                            //console.log(actionArray);
                            let a = Math.floor(Math.random() * actionArray.length);
                            action = actionArray[a];
                        }
                        if(actionCount == 3)
                        {
                            let actionArray =
                            [
                                ["@1n#, #@2n#, and #@3n# form a suicide pact and all kill themselves.#@1k#@2k#@3k"],
                                ["@1n#, #@2n#, and #@3n# form a suicide pact but it fails, leaving them all injured.#@1h#@2h#@3h"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@1n# gets the backpack, killing the other two.#@1ig#@2k#@3k"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@3n# gets the backpack, killing the other two.#@3ig#@2k#@1k"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@2n# gets the backpack, killing the other two.#@2ig#@1k#@3k"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@1n# gets the backpack, hurting the other two.#@1ig#@2h#@3h"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@3n# gets the backpack, hurting the other two.#@3ig#@2h#@1h"],
                                ["@1n#, #@2n#, and #@3n# fight for a backpack and #@2n# gets the backpack, hurting the other two.#@2ig#@1h#@3h"],
                            ];
                            actionArray = addActions(currentCharacters[0], actionArray, 3);

                            let a = Math.floor(Math.random() * actionArray.length);
                            action = actionArray[a];
                        }
                        var actionText = action[0].toString().split("#");
                        for (let n = 0; n < actionText.length; n++) {
                            var current = actionText[n];
                            if (current.charAt(0) == "@") {
                                if (current.charAt(1) == "1") {
                                    if (current.charAt(2) == "n") {
                                        actionText[n] = currentCharacters[0].name;
                                    }
                                    else if (current.charAt(2) == "h") {
                                        actionText[n] = "";
                                        currentCharacters[0].hurt = true;
                                    }
                                    else if (current.charAt(2) == "k") {
                                        currentCharacters[0].dead = true;
                                        actionText[n] = "";
                                    } 
                                    else if (current.charAt(2) == "r") {
                                        currentCharacters[0].hurt = false;
                                        actionText[n] = "";
                                    }
                                    else if (current.charAt(2) == "w") {
                                        if (current.charAt(3) == "b") {
                                            livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Bow");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "s") {
                                            livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Sword");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "e") {
                                            livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Explosive");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "i") {
                                        if (current.charAt(3) == "w") {
                                            if (current.charAt(4) == "0") 
                                            {
                                                livingCharacters[findPlayer(currentCharacters[0].name)].items.splice(findItem(currentCharacters[0],"Water"),1);
                                            }
                                            else
                                            {
                                                livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Water");
                                            }
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "f") {
                                            if (current.charAt(4) == "0") 
                                            {
                                                livingCharacters[findPlayer(currentCharacters[0].name)].items.splice(findItem(currentCharacters[0],"Food"),1);
                                            }
                                            else
                                            {
                                                livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Food");
                                            }
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "g") {
                                            livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Gear");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "h") {
                                            livingCharacters[findPlayer(currentCharacters[0].name)].items.push("Health");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "0") {
                                        actionText[n] = currentCharacters[0].pronouns[0];
                                    }
                                    else if (current.charAt(2) == "1") {
                                        actionText[n] = currentCharacters[0].pronouns[1];
                                    }
                                    else if (current.charAt(2) == "2") {
                                        actionText[n] = currentCharacters[0].pronouns[2];
                                    }
                                    else if (current.charAt(2) == "3") {
                                        actionText[n] = currentCharacters[0].pronouns[3];
                                    }
                                }
                                if (current.charAt(1) == "2") {
                                    if (current.charAt(2) == "n") {
                                        actionText[n] = currentCharacters[1].name;
                                    }
                                    else if (current.charAt(2) == "h") {
                                        actionText[n] = "";
                                        currentCharacters[1].hurt = true;
                                    }
                                    else if (current.charAt(2) == "k") {
                                        currentCharacters[1].dead = true;
                                        actionText[n] = "";
                                    } 
                                    else if (current.charAt(2) == "r") {
                                        currentCharacters[1].hurt = false;
                                        actionText[n] = "";
                                    }
                                    else if (current.charAt(2) == "w") {
                                        if (current.charAt(3) == "b") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Bow");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "s") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Sword");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "e") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Explosive");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "i") {
                                        if (current.charAt(3) == "w") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Water");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "f") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Food");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "s") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Shield");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "g") {
                                            livingCharacters[findPlayer(currentCharacters[1].name)].items.push("Gear");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "0") {
                                        actionText[n] = currentCharacters[1].pronouns[0];
                                    }
                                    else if (current.charAt(2) == "1") {
                                        actionText[n] = currentCharacters[1].pronouns[1];
                                    }
                                    else if (current.charAt(2) == "2") {
                                        actionText[n] = currentCharacters[1].pronouns[2];
                                    }
                                    else if (current.charAt(2) == "3") {
                                        actionText[n] = currentCharacters[1].pronouns[3];
                                    }
                                }
                                if (current.charAt(1) == "3") {
                                    if (current.charAt(2) == "n") {
                                        actionText[n] = currentCharacters[2].name;
                                    }
                                    else if (current.charAt(2) == "h") {
                                        actionText[n] = "";
                                        currentCharacters[2].hurt = true;
                                    }
                                    else if (current.charAt(2) == "k") {
                                        currentCharacters[2].dead = true;
                                        actionText[n] = "";
                                    } 
                                    else if (current.charAt(2) == "r") {
                                        currentCharacters[2].hurt = false;
                                        actionText[n] = "";
                                    }
                                    else if (current.charAt(2) == "w") {
                                        if (current.charAt(3) == "b") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Bow");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "s") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Sword");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "e") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Explosive");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "i") {
                                        if (current.charAt(3) == "w") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Water");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "f") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Food");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "s") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Shield");
                                            actionText[n] = "";
                                        }
                                        if (current.charAt(3) == "g") {
                                            livingCharacters[findPlayer(currentCharacters[2].name)].items.push("Gear");
                                            actionText[n] = "";
                                        }
                                    }
                                    else if (current.charAt(2) == "0") {
                                        actionText[n] = currentCharacters[2].pronouns[0];
                                    }
                                    else if (current.charAt(2) == "1") {
                                        actionText[n] = currentCharacters[2].pronouns[1];
                                    }
                                    else if (current.charAt(2) == "2") {
                                        actionText[n] = currentCharacters[2].pronouns[2];
                                    }
                                    else if (current.charAt(2) == "3") {
                                        actionText[n] = currentCharacters[2].pronouns[3];
                                    }
                                }
                                
                            }
                        }

                        var actionTextElement = document.createElement("a");
                        actionTextElement.innerHTML = "<br> <br> <br>" + actionText.join("") + "<br>";
                        characterBoxes.appendChild(actionTextElement);

                        var character = currentCharacters[0];
                        // Display character in box below start button
                        var characterBox = document.createElement("div");
                        characterBox.classList.add("characterBox");
                        characterBox.innerHTML = `
                        <p>${character.name}</p>`
                        if (!currentCharacters[0].dead) {
                            characterBox.innerHTML += `
                        <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px;">
                        `;
                        }
                        else {
                            livingCharacters.splice(findPlayer(character.name),1);
                            characterBox.innerHTML += `
                        <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px; filter: grayscale(1);">
                        `;
                        }
                        characterBoxes.appendChild(characterBox);


                        if (actionCount >= 2) 
                        {
                            character = currentCharacters[1];
                            // Display character in box below start button
                            characterBox = document.createElement("div");
                            characterBox.classList.add("characterBox");
                            characterBox.innerHTML = `
                            <p>${character.name}</p>`
                            if (!character.dead) {
                                characterBox.innerHTML += `
                            <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px;">
                            `;
                            }
                            else {
                                livingCharacters.splice(findPlayer(character.name),1);
                                characterBox.innerHTML += `
                            <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px; filter: grayscale(1);">
                            `;
                            }
                            characterBoxes.appendChild(characterBox);
                        }
                        if (actionCount >= 3) 
                        {
                            character = currentCharacters[2];
                            // Display character in box below start button
                            characterBox = document.createElement("div");
                            characterBox.classList.add("characterBox");
                            characterBox.innerHTML = `
                            <p>${character.name}</p>`
                            if (!character.dead) {
                                characterBox.innerHTML += `
                            <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px;">
                            `;
                            }
                            else {
                                livingCharacters.splice(findPlayer(character.name),1);
                                characterBox.innerHTML += `
                            <img src="${character.imageSrc}" alt="${character.name}" style="height: 120px; filter: grayscale(1);">
                            `;
                            }
                            characterBoxes.appendChild(characterBox);
                        }
                        
                        for (let a = 0; a < actionCount; a++) {
                            currentCharacters.shift();
                        }
                    
                }
            }  

            var nextButton = document.createElement("a");
            nextButton.innerHTML = `<br><button id="nextTurn" onclick="turn()" style="margin: 10px;">Next</button>`;
            characterBoxes.appendChild(nextButton);
        }

        function findPlayer(name)
        {
            for (let i = 0; i < livingCharacters.length; i++) {
                if(name == livingCharacters[i].name)
                {
                    return i;
                }
            }
        }

        function findItem(character, item)
        {
            for (let i = 0; i < character.items.length; i++) {
                if(item == character.items[i])
                {
                    return i;
                }
            }
        }

    </script>

</body>

</html>
